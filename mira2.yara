import "hash"

rule mirai1
{
  condition:
    hash.sha256(0, filesize) ==
        "06db092079fc9ab3fcd2b225719b0567121bb7d9e8625b26ba7d0ef1ed58dc3c"
    
}

rule mirai2
{
  condition:
    hash.sha256(0, filesize) ==
        "194baf0aabb4ef1709ce2709b5262884d82934fb2d9bc1db0798b8061711b876"
    
}

rule mirai3
{
  condition:
    hash.sha256(0, filesize) ==
        "477a7624d15eea47abe36a17caa8f4ded51b7bf31ab05c6c5b1f14033d271c70"
    
}

rule mirai4
{
  condition:
    hash.sha256(0, filesize) ==
        "47e1b4dfe71e19d6a4b27b8071d18509b51a6e4d9f7fde4c65732331cd55e0e8"
    
}

rule mirai5
{
  condition:
    hash.sha256(0, filesize) ==
        "a1f7df9a49a69f7569617b60759075c7c2b0db65c9d5fecd7dc0069fd22df761"
    
}

rule mirai6
{
  condition:
    hash.sha256(0, filesize) ==
        "fd5c4e56edc6ca2248b732b61cb9aeed1fb65f733d2ae7bd6fa8b5077046da65"
    
}

rule mirai7
{
  condition:
    hash.sha256(0, filesize) ==
        "8c0d5df219cf7153940d95a3346a1b9418a7948e0d4474fa558e01e78042882e"
    
}

rule mirai8
{
  condition:
    hash.sha256(0, filesize) ==
        "c9984a342a6517e6ac64845bd98b08e08ac3cb33b5e3f5cb016af0e1bf72c8d1"
    
}

rule mirai9
{
  condition:
    hash.sha256(0, filesize) ==
        "0ea52a3a614157e575c3b553902689d0e9169e01cf7a19f55a41bbdfb397bf34"
    
}

rule mirai10
{
  condition:
    hash.sha256(0, filesize) ==
        "1a0e17855783e1c75a9e8fe8d8a9403e15ae02e61a6dc25bb3f5c7ccae3a1c88"
    
}

rule mirai11
{
  condition:
    hash.sha256(0, filesize) ==
        "cf11d349bf563d43be5384b6dbebe1eb16083028503f66eaa1f4808990e8df27"
    
}

rule mirai12
{
  condition:
    hash.sha256(0, filesize) ==
        "0157847dc493399f28e4bbf98ae82bd05a216d9a0dff2c06bb66a489f62eb337"
    
}

rule mirai13
{
  condition:
    hash.sha256(0, filesize) ==
        "5aa399dacc7074be60a1296310b999c0690c24cd44f0c478b59a5e45370eb38e"
    
}

rule mirai14
{
  condition:
    hash.sha256(0, filesize) ==
        "e339c0fc71e1860be269bed70e8c577e30c84b74030fb9272eb9419446383d4f"
    
}

rule mirai15
{
  condition:
    hash.sha256(0, filesize) ==
        "eb16fe5cdc25c1b89b44bda5aefa2525c3e8550bda62afb7277aacf1c48431d7"
    
}

rule mirai16
{
  condition:
    hash.sha256(0, filesize) ==
        "f21b6f14d5895a66740bb2007da519b1c61c4618803c1271b967bdd2e5960641"
    
}

rule mirai17
{
  condition:
    hash.sha256(0, filesize) ==
        "5528a6097b7dc592ca8946cb04c043267e842bcd3f3216bad6b41393e6878cee"
    
}

rule mirai18
{
  condition:
    hash.sha256(0, filesize) ==
        "c11b5f290bf114463cb5839d458e915d22726d25850bc937e4032c5167846fa5"
    
}

rule mirai19
{
  condition:
    hash.sha256(0, filesize) ==
        "b58b00b5acab0d3881b342a1958470989b3cf3b604d5252dfcc7f88a6f1aec89"
    
}

rule mirai20
{
  condition:
    hash.sha256(0, filesize) ==
        "bb2adb221cf5043f8b4db79e5b516a15add36a4ddccb7819f6b79585b6f4a286"
    
}

rule mirai21
{
  condition:
    hash.sha256(0, filesize) ==
        "a212543d5b5911be231d73175c7244ef864d29377685040c2cce61fa3efb5445"
    
}

rule mirai22
{
  condition:
    hash.sha256(0, filesize) ==
        "f6ffb261c50cb6af846638da36965c9eb460e06dbe134f814134f5f66462e0df"
    
}

rule mirai23
{
  condition:
    hash.sha256(0, filesize) ==
        "0d0530464b3e67e28f726f2902d15da6e0352beeffe5c1291cb776bfb64c609c"
    
}

rule mirai24
{
  condition:
    hash.sha256(0, filesize) ==
        "b640900d61eab4202b0bf6e953b6eb799ff0493db58a27ab022a3e2c497c0c85"
    
}

rule mirai25
{
  condition:
    hash.sha256(0, filesize) ==
        "dc82ca50eca7f7bffd3b330df6d9430856941049688ac39a6a20be84460a5cfb"
    
}

rule mirai26
{
  condition:
    hash.sha256(0, filesize) ==
        "ec68d7ae0890542ea8814c689414cf87641c33aed5c8d65b836a7431f40adbc7"
    
}

rule mirai27
{
  condition:
    hash.sha256(0, filesize) ==
        "2a47d96d52448a2f43c1b832265b2c79bc5cb3b394796ca92158650c59ed0fe8"
    
}

rule mirai28
{
  condition:
    hash.sha256(0, filesize) ==
        "930ada811e8b3711ed6b90a1b23972ba06205c0ae24748295f77cde0f6abada2"
    
}

rule mirai281
{
  condition:
    hash.sha256(0, filesize) ==
        "c550a6b0eb8afb461c178deeb8a40a029f07c2cb57e18a2b584f5b2046641a91"
    
}

rule mirai29
{
  condition:
    hash.sha256(0, filesize) ==
        "27836566adc152b711e05ab2a3f2fae56039908af5fb67eb1dbe8f8e1a04122d"
    
}

rule mirai30
{
  condition:
    hash.sha256(0, filesize) ==
        "f8b3e0310f2efe924f914f1ea25b5fc569757a5a96d74811d3c808e568332d4e"
    
}

rule mirai31
{
  condition:
    hash.sha256(0, filesize) ==
        "137532a130b1cea1520315c3e4f936651812807842de12814d7ed9043b300808"
    
}

rule mirai32
{
  condition:
    hash.sha256(0, filesize) ==
        "3a250b7d092df3d1071e39b7a478b6d9267fe5dc6983c5514eaabbbbd6740547"
    
}

rule mirai33
{
  condition:
    hash.sha256(0, filesize) ==
        "a0d0d513469f9f213fb7a6746b1f94f1173ef7d69c834d924bbadfe9d2a789cc"
    
}

rule mirai34
{
  condition:
    hash.sha256(0, filesize) ==
        "117e74e6d5c74146bdc66ae7b2cc5e148104b3128c2b48de07066e327d0f0fbb"
    
}

rule mirai35
{
  condition:
    hash.sha256(0, filesize) ==
        "060fa8f67a905f43c722e457c75276af7a52d6a7518e27085556679114efd997"
    
}

rule mirai36
{
  condition:
    hash.sha256(0, filesize) ==
        "4234dc3d2b2cd2a9c398550c710712e42cac46149d0069197df182d40a7bf50f"
    
}

rule mirai37
{
  condition:
    hash.sha256(0, filesize) ==
        "e25e308171e263f5f64937d0b5a6610133e2c3fcf6a3af16b430e8e957dd1593"
    
}

rule mirai38
{
  condition:
    hash.sha256(0, filesize) ==
        "729de93bc19f8be885489ceb0815a46dc899beea277596b52bb8d54b7a648422"
    
}

rule mirai39
{
  condition:
    hash.sha256(0, filesize) ==
        "1a3787e3d1fae0a4fe742d9d38b35e36851da6b5c7186adeb874812bdb004bea"
    
}

rule mirai40
{
  condition:
    hash.sha256(0, filesize) ==
        "4721d351f7d60b6f73dd6e749d5d089aa6f55afa52fa84051e10a719229d6434"
    
}

rule mirai41
{
  condition:
    hash.sha256(0, filesize) ==
        "0308459dfb913a3648bc2221a6cb559e6959335f59b40ee5fe67112f59020edc"
    
}

rule mirai42
{
  condition:
    hash.sha256(0, filesize) ==
        "1f33e44067287ff5c4104f8bbe22b77ad05d935458a6f5c71462bdff49d0ece1"
    
}

rule mirai43
{
  condition:
    hash.sha256(0, filesize) ==
        "2158bd12bf7b7edd41b04e2b7571e9fabd62ab35c3168296973b1c1e74cd6e81"
    
}

rule mirai44
{
  condition:
    hash.sha256(0, filesize) ==
        "a22926e5a56297c9f3f2081362b07caf284b599ac41febb56242fc6d3ef12797"
    
}

rule mirai45
{
  condition:
    hash.sha256(0, filesize) ==
        "3fa6d7197bbec5bb1d96f97f1737645b22cb844c11a3aed930cd2b2b3d659be3"
    
}

rule mirai46
{
  condition:
    hash.sha256(0, filesize) ==
        "801ce464fc38b4c1ca1f277810a5b65c579cb8120fbe82cbc0b4f73cf9c23b04"
    
}

rule mirai47
{
  condition:
    hash.sha256(0, filesize) ==
        "32019784fde994bc35b502cce1c397559e2d0c6bc5ff3e93649b5fc605c81845"
    
}

rule mirai48
{
  condition:
    hash.sha256(0, filesize) ==
        "1c7dde1146f1ba25ef8434d02580372a3b75500a6603d527ecf013192b26f670"
    
}

rule mirai49
{
  condition:
    hash.sha256(0, filesize) ==
        "ae7d60c0041fbd39b0de4d52160b308ab8681a6b097c73d76d1630444f98353c"
    
}

rule mirai50
{
  condition:
    hash.sha256(0, filesize) ==
        "2fbdb70a9220aa55d9a965d01774701c5d712e88eb27feddbe2003bf19f78ce8"
    
}

rule mirai51
{
  condition:
    hash.sha256(0, filesize) ==
        "52fdcde53105dfa5b06b3d4efafb79da95f3867e5c8619f526c869dd6d754ae0"
    
}

rule mirai52
{
  condition:
    hash.sha256(0, filesize) ==
        "ea99e26bfb41ff191b29199f2d8d6b53e9fc2e2621abb0ca00bbccc191151bf6"
    
}

rule mirai53
{
  condition:
    hash.sha256(0, filesize) ==
        "17a9006407950ecd9c50c24a7cda4bf2536d683eb84c4266c0aa9838197ebae4"
    
}

rule mirai54
{
  condition:
    hash.sha256(0, filesize) ==
        "716e09e72fc2529fafe0698406764bde5f4197314587d394a1ceecd6feee7dfb"
    
}

rule mirai55
{
  condition:
    hash.sha256(0, filesize) ==
        "065eeb09b2c2e7a8c8664b4de35ca3219def4754e9b26bcd43f5e6a8c6649b4d"
    
}

rule mirai56
{
  condition:
    hash.sha256(0, filesize) ==
        "e6503a9d937d92f5086d7e330783443d7e255f9c807b940a499ed70757bc6312"
    
}

rule mirai57
{
  condition:
    hash.sha256(0, filesize) ==
        "91c26ea3c23ce864d6285d0db3e80333b3c58adab6e3e85e5d527fd0776ecf7b"
    
}

rule mirai58
{
  condition:
    hash.sha256(0, filesize) ==
        "0bff380e3afc00cae803e1539ed95192a5668d9bfdc528990fff0404eaa421f3"
    
}

rule mirai59
{
  condition:
    hash.sha256(0, filesize) ==
        "ef24c5f6ba56bb0761d69486389e900f2d7959f93758e4e854f9094f2fd64a6c"
    
}

rule mirai60
{
  condition:
    hash.sha256(0, filesize) ==
        "fa738a5a3abcc40bb979d0b71135f14b1041ff773f6c93f500ec07e4edaf8fdd"
    
}

rule mirai61
{
  condition:
    hash.sha256(0, filesize) ==
        "33c2ed520416d7b003f9727d717b55be33ea9d83e33fa294b3775892998af2f4"
    
}

rule mirai62
{
  condition:
    hash.sha256(0, filesize) ==
        "9a5f8322ccc6fd82ccef19fbc2f3647d83c1d44a998236557207e34b9a86968c"
    
}

rule mirai63
{
  condition:
    hash.sha256(0, filesize) ==
        "c6cd6be14ac5f114e70e02ac6e45181deb6510f93bad3016739ca329894887e9"
    
}

rule mirai64
{
  condition:
    hash.sha256(0, filesize) ==
        "0b388a43dc8505d183e56dbcc2d13d1cc5cfe7b6c1b7e88aa4c970e133e249ef"
    
}

rule mirai65
{
  condition:
    hash.sha256(0, filesize) ==
        "7c4169afb95dbf9379c0230e1360f6ec398b6e05c62c1f650581b3af3de55a93"
    
}

rule mirai66
{
  condition:
    hash.sha256(0, filesize) ==
        "27f22cc044fbc4effd6a36b52833f099c0f387ce84f9f784e95b4d5e4bd2e259"
    
}

rule mirai67
{
  condition:
    hash.sha256(0, filesize) ==
        "92459513bb5128d8f3d817d9ff98fe1264a280626ac55142af4aaf89110ee74b"
    
}

rule mirai68
{
  condition:
    hash.sha256(0, filesize) ==
        "bd443f8bd709917299cdb8800121741eb1db923aad55684a22ce71368000830c"
    
}

rule mirai69
{
  condition:
    hash.sha256(0, filesize) ==
        "28c61c85e44afc301f7c920891ceef01040b1c5e0b2ddc3a263e28b21b7ab5a9"
    
}

rule mirai70
{
  condition:
    hash.sha256(0, filesize) ==
        "57307aca0d261ebd438f0a507a1afbdd2eb1635cb8ee5c2b8aa21c96db5c4daa"
    
}

rule mirai71
{
  condition:
    hash.sha256(0, filesize) ==
        "d87011b7f64eb9f8b3037d5e43e144d5376cab45fdfcb1333ef4607f497157d2"
    
}

rule mirai72
{
  condition:
    hash.sha256(0, filesize) ==
        "29596ef238bbbd389c7822bee9695ee3cac76819e4791e4376a1d76d3c9fc644"
    
}

rule mirai73
{
  condition:
    hash.sha256(0, filesize) ==
        "d0c04bd037c98321abec258b03de49af2f94b6c8e39e055f4cbc59caf366bf08"
    
}

rule mirai74
{
  condition:
    hash.sha256(0, filesize) ==
        "a5ff09b42241d31cc94c7f63f0c1a16d0ce1fdbaaa68fb49cfb98b83c0367cd0"
    
}

rule mirai75
{
  condition:
    hash.sha256(0, filesize) ==
        "48378b72cbf2a7ce68b63b7c0ba0eb27d90472c03ec266fcf0b43129f10dd1ed"
    
}

rule mirai76
{
  condition:
    hash.sha256(0, filesize) ==
        "495a84d8b655dfa5097212c638c49d8775c9c66e3cb949aeaa4b8e2612f5fda9"
    
}

rule mirai77
{
  condition:
    hash.sha256(0, filesize) ==
        "12a18f2b9400a65329a7b34898eb8afae2cbbd18abec5364e84eba91b12154fc"
    
}

rule mirai78
{
  condition:
    hash.sha256(0, filesize) ==
        "863846e0791c75ecbc49a812a2f42f42bc11a9f729fef98e7018b7d3188d9681"
    
}

rule mirai79
{
  condition:
    hash.sha256(0, filesize) ==
        "aa3cc5cbc99670cf544befac72794b12f166c0c19c8aa5acc7896c9357a1e9ce"
    
}

rule mirai80
{
  condition:
    hash.sha256(0, filesize) ==
        "bd21f60d9032c7b5cc9db775517a726bf21c106350701f5b06bf4abff197c412"
    
}

rule mirai81
{
  condition:
    hash.sha256(0, filesize) ==
        "282031be993776cd842cd829f06249c7f5256d11cac0a41678e4de39724aeff0"
    
}

rule mirai82
{
  condition:
    hash.sha256(0, filesize) ==
        "f60dc2b3fa7c60b237547831237974f1a5ba0136595b07f24f2347e5ce5bbb12"
    
}

rule mirai83
{
  condition:
    hash.sha256(0, filesize) ==
        "6d5f1dea4a2632918c87360f96c4ae8163ab0b184f1e2c09026a9ca20746979d"
    
}

rule mirai84
{
  condition:
    hash.sha256(0, filesize) ==
        "f4766169a2f328d9fe36b990983cafb94ad2bef88dd3f4102570b2463326521c"
    
}

rule mirai85
{
  condition:
    hash.sha256(0, filesize) ==
        "4afdfdc6fbdedfb18ef42e1d2999e79d1465c34af4afa4d132c33a3bcc57b185"
    
}

rule mirai86
{
  condition:
    hash.sha256(0, filesize) ==
        "9276dfc6ac882c9b61cc7b77b1f8d04b1ada798848edef661717e5be36eb157d"
    
}

rule mirai87
{
  condition:
    hash.sha256(0, filesize) ==
        "67b17f1fd0311a222de216f33993511d98d96c32679badd2dc39b64a5286224f"
    
}

rule mirai88
{
  condition:
    hash.sha256(0, filesize) ==
        "75c6555e3ce7d86dca6bb3df6f9ce911560b014ccd36b350c727fc408905d5d8"
    
}

rule mirai89
{
  condition:
    hash.sha256(0, filesize) ==
        "a80d462fb00b6e58df84df935721e8a9968a49682b7e8e39e7dd58782f357bc4"
    
}

rule mirai90
{
  condition:
    hash.sha256(0, filesize) ==
        "bf50c8b537df146fbb963448a4b0267f43e9632c47fe866a3ac16ed5a4195fc0"
    
}

rule mirai91
{
  condition:
    hash.sha256(0, filesize) ==
        "350071663640bd83f732a7831ce83a6073dc9b2b66b01bbc35a9224de7e500f3"
    
}

rule mirai92
{
  condition:
    hash.sha256(0, filesize) ==
        "eadbbb36408913eb2970db1e2c3b1e9198b91debef04ab33426bb12e60a0b0b3"
    
}

rule mirai93
{
  condition:
    hash.sha256(0, filesize) ==
        "deb05b353c51481cba1eb6acfac01d4e4a1e0bf687f8ad6bb54c51b2e0b04e2c"
    
}

rule mirai94
{
  condition:
    hash.sha256(0, filesize) ==
        "a051efe0398ed3dd54b355c9bf6988775789b7a44c6c43beb49477a55adecf47"
    
}

rule mirai95
{
  condition:
    hash.sha256(0, filesize) ==
        "16fef6652f7bfaa99b4c6f363d839c4ff782e4db905a8fdd06ddba3615670c89"
    
}

rule mirai96
{
  condition:
    hash.sha256(0, filesize) ==
        "5c60f217aefb31989c18abf629e09413213045a9b59131128647ae1aafbfb73b"
    
}

rule mirai97
{
  condition:
    hash.sha256(0, filesize) ==
        "e4b00b9c3b2ea39757c962be76f2a077bebf69257bd8826b80884663864db508"
    
}

rule mirai98
{
  condition:
    hash.sha256(0, filesize) ==
        "60d712bc943f1b25405576304dd1e6ecc2d77979d25655a8a2f9b48844cf62f4"
    
}

rule mirai99
{
  condition:
    hash.sha256(0, filesize) ==
        "e4faa2ef48df9f31b26744fc8fa03202a926b1fc402d3191b8d5ab3fc323e23d"
    
}

rule mirai100
{
  condition:
    hash.sha256(0, filesize) ==
        "3b45d2cfdf861ff83fc8dc61f9971ac40d061021351249de2cfc4b1d17e22eca"
    
}

rule mirai101
{
  condition:
    hash.sha256(0, filesize) ==
        "eb9fba27e7b10fbab00f31bba82d2816955f3a3f57f2e8d94dc3ed1f4feb4381"
    
}

rule mirai102
{
  condition:
    hash.sha256(0, filesize) ==
        "c6de77dc7872f3e99f57bb8c4a8e4c3f959fd6f7e40b9b29b028826e369a732d"
    
}

rule mirai103
{
  condition:
    hash.sha256(0, filesize) ==
        "9c43c155960ebd7aa334d76e6fb7396edd182231a14767250fc00a350b74adba"
    
}

rule mirai104
{
  condition:
    hash.sha256(0, filesize) ==
        "392084ae5ec6d21051fa38bfbe4323869f40fdcd825fc0c0f11b604b4cfee80f"
    
}

rule mirai105
{
  condition:
    hash.sha256(0, filesize) ==
        "c2f47dfdb6b1de9f3cc6cee840dcaa037055f5018219dc954b3ce10f46641675"
    
}

rule mirai106
{
  condition:
    hash.sha256(0, filesize) ==
        "f1fad1ffc73042775e2fc8f608c5f6a0ffb2495ff4619004ad66c1083aa9cfb4"
    
}

rule mirai107
{
  condition:
    hash.sha256(0, filesize) ==
        "5b363fd7d293e0db2251b617fc3fb78357272eea979953f3b7eaddba58dd540b"
    
}

rule mirai108
{
  condition:
    hash.sha256(0, filesize) ==
        "977e5d00b8033ef241437a790df4ce87a105ee17436ccf1edae1b2881314e1ae"
    
}
rule mirai109

{
  condition:
    hash.sha256(0, filesize) ==
        "7d40ac238cd702e13d4816927c1fa0913e4d866c1f57937a2caa50ee4cf791f8"
    
}
rule mirai110
{
  condition:
    hash.sha256(0, filesize) ==
        "9f2482ab56beb28d05d9a8c2e840f340f7aeae4b2cbeba047eb2b295d5c799b6"
    
}
rule mirai111
{
  condition:
    hash.sha256(0, filesize) ==
        "81971f3b48acbf39e2fc079cdd78c42c4878326e38d7447326fbac8172191f0d"
    
}
rule mirai112
{
  condition:
    hash.sha256(0, filesize) ==
        "a6ddc8f22bd2d61344c826e66503b856fbba3b4b17401a632278629d7d613167"
    
}
rule mirai113
{
  condition:
    hash.sha256(0, filesize) ==
        "b87c88ab097b8f20a930f4a35a6e45875b4614aca890d9cc4173ed15549cc540"
    
}
rule mirai114
{
  condition:
    hash.sha256(0, filesize) ==
        "48f0d9b4d75e385cc2e68ad203e5b0040f5a6ea2ea5c137bc1cf05fbdec8e855"
    
}


rule ELF_Mirai {
    meta:
        author = "NDA0E"
        yarahub_author_twitter = "@NDA0E"
        date = "2024-08-09"
        description = "Detects multiple Mirai variants"
        yarahub_uuid = "386c1b6c-c5f9-4a9c-a83f-1f940f4d2c2e"
        yarahub_license = "CC BY 4.0"
        yarahub_rule_matching_tlp = "TLP:WHITE"
        yarahub_rule_sharing_tlp = "TLP:WHITE"
        yarahub_reference_md5 = "7f5d67a7309d7ff399247f1c43a92ad4"
        malpedia_family = "elf.mirai"

    strings:
        $mirai = "ATTACKRUNNING" ascii
        $mirai2 = "get_ips_in_that_block" ascii
        $mirai3 = "*/15 * * * * %s" ascii
        $mirai4 = "attack_method_" ascii
        $mirai5 = "User-Agent: Uirusu/2.0" ascii
        $mirai6 = "attack_parser" ascii
        $mirai7 = "udpplain_flood" ascii
        $mirai8 = "[0m Device Joined As [" ascii
        $mirai9 = "killall -9 telnetdbot; killall -9 Challenge; killall -9 oxdedfgt; killall -9 eBot; killall -9 lzrd" ascii
        $mirai10 = "%255s %255s %*s %255[^" ascii
        $mirai11 = "POST /ctrlt/DeviceUpgrade_1 HTTP/1.1" ascii
        $mirai12 = "echo \"Found process the and kill pid: $PID\"" ascii
        $mirai13 = "PID=$(echo $line | grep -o \"/proc/[0-9]*\" | grep -o \"[0-9]*\")" ascii
        $mirai14 = "KillerStartListener" ascii
        $mirai15 = "port_killer.c" ascii
        $mirai16 = "AttackTcpRaw" ascii
        $mirai17 = "AttackUdpRaw" ascii
        $mirai18 = ".tcp %s %s %d %s %d %d %s %d" ascii
        $mirai19 = ".udp %s %s %s %d %d %d %d" ascii
        $mirai20 = ".sudp %s %s %s %d %d %d" ascii
        $mirai21 = ".handshake %s %s %d %d" ascii
        $mirai22 = ".psh %s %s %s %d %d %d" ascii
        $mirai23 = ".syn %s %s %d %d" ascii
        $mirai24 = "setsockopt() SO_SNDTIMEO" ascii
        $mirai25 = "hostname Kamru" ascii
        $mirai26 = "(Killer) >> KILLING PID: (%s)" ascii
	$mirai27 = "telnetd|udhcpc|ntpclient|boa|httpd|mini_http|watchdog|pppd" ascii
	$mirai28 = "Found And Killed Process: PID=%d, Realpath=%s" ascii
	$mirai29 = "Killed Process: %s, PID: %d" ascii
        
        $arch = ".arm" ascii
        $arch2 = ".mpsl" ascii
        $arch3 = ".mips" ascii
        $arch4 = ".ppc" ascii
        $arch5 = ".x86" ascii
        $arch6 = ".m68k" ascii
        $arch7 = ".m88k" ascii
        $arch8 = ".sh4" ascii
        $arch9 = ".spc" ascii
        
        $archx = "_ARM" ascii
        $archx2 = "_MPSL" ascii
        $archx3 = "_MIPS" ascii
        $archx4 = "_PPC" ascii
        $archx5 = "_X86" ascii
        $archx6 = "_M68K" ascii
        $archx7 = "_M88K" ascii
        $archx8 = "_SH4" ascii
        $archx9 = "_SPC" ascii
        
        $shell_script = "\\x23\\x21\\x2F\\x62\\x69\\x6E\\x2F\\x73\\x68\\x0A\\x0A\\x66\\x6F\\x72\\x20\\x70\\x69\\x64\\x20\\x69\\x6E\\x20\\x2F\\x70\\x72\\x6F\\x63\\x2F\\x5B\\x30\\x2D\\x39" ascii
        $shell_script2 = "\\x5D\\x2A\\x3B\\x20\\x64\\x6F\\x0A\\x20\\x20\\x20\\x20\\x63\\x61\\x73\\x65\\x20\\x24\\x28\\x6C\\x73\\x20\\x2D\\x6C\\x20\\x24\\x70\\x69\\x64\\x2F\\x65\\x78\\x65" ascii
        $shell_script3 = "\\x29\\x20\\x69\\x6E\\x0A\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x2A\\x22\\x28\\x64\\x65\\x6C\\x65\\x74\\x65\\x64\\x29\\x22\\x2A\\x7C\\x2A\\x22\\x2F\\x2E\\x22" ascii
        $shell_script4 = "\\x2A\\x29\\x20\\x6B\\x69\\x6C\\x6C\\x20\\x2D\\x39\\x20\\x24\\x7B\\x70\\x69\\x64\\x23\\x23\\x2A\\x2F\\x7D\\x20\\x3B\\x3B\\x0A\\x20\\x20\\x20\\x20\\x65\\x73\\x61" ascii
        $shell_script5 = "\\x63\\x0A\\x64\\x6F\\x6E\\x65\\x0A" ascii

        // Decoded shell script:
        // #!/bin/sh
        //
        // for pid in /proc/[0-9]*; do
        //     case $(ls -l $pid/exe) in
        //         *"(deleted)"*|*"./"*)
        //             kill -9 ${pid##*/} ;;
        //     esac
        // done

    condition:
	(any of ($mirai*) or
    	4 of ($arch*) or
    	4 of ($archx*) or
    	all of ($shell_script*)) and
	uint16(0) == 0x457f
}

rule win_x86_x64_Mirai {
    meta:
        author = "NDA0E"
        yarahub_author_twitter = "@NDA0E"
        date = "2025-01-26"
        description = "Detects Mirai"
        yarahub_uuid = "c0257af9-5608-4c28-8a94-4060ddd22602"
        yarahub_license = "CC BY 4.0"
        yarahub_rule_matching_tlp = "TLP:WHITE"
        yarahub_rule_sharing_tlp = "TLP:WHITE"
        yarahub_reference_md5 = "800dcb9f93715f5ed7189be2e35aebd9"
        malpedia_family = "win.mirai"
        
    strings:
        $c2_send = {
            4? 8b ??       // MOV   RAX,qword ptr [->WS2_32.DLL::send]
            ?? ?? ?? ??
            ff d?          // CALL  RAX=>WS2_32.DLL::send
            4? 8d ??       // LEA   RAX,[s_win_x86_x64_14000c351] = "win_x86_x64"
            ?? ?? ?? ??
            48 89 ??       // MOV   qword ptr [RBP + local_18],RAX=>s_win_x86_x64_ = "win_x86_x64"
            ?? ?? ?? ??
            4? 8b ??       // MOV   RAX,qword ptr [RBP + local_18]
            ?? ?? ?? ??
            4? 89 ??       // MOV   _Argc=>s_win_x86_x64_14000c351,RAX = "win_x86_x64"
            e8 ?? ??       // CALL  strlen
            ?? ??
        }

        $c2_recv = {
            4? 8b ??       // MOV   RAX,qword ptr [->WS2_32.DLL::recv]
            ?? ?? ?? ??
            ff d?          // CALL  RAX=>WS2_32.DLL::recv
            89 ?? ??       // MOV   dword ptr [RBP + local_24],EAX
            ?? ?? ??
            83 b? ??       // CMP   dword ptr [RBP + local_24],0x0
            ?? ?? ?? ??
            79 ??          // JNS   LAB_140003ef5
            4? 8d ??       // LEA   _Argc,[s_recv_failed_14000c35d] = "recv failed"
            ?? ?? ?? ??
            e8 ?? ??       // CALL  perror
            ?? ??
            e9 ?? ??       // JMP   LAB_140003f75
            ?? ??
        }

    condition:
        all of them
}